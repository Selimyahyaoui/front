<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Assets (T_AssetReport)</title>
  <link rel="stylesheet" href="/static/style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <!-- White banner header (same vibe as catalogue) -->
  <header>
    <img src="/static/bnp_logo.png" class="logo" alt="BNP">
    <h1>Assets (inventaire)</h1>
  </header>

  <div class="content">
    <!-- Toolbar: search + per-page + actions -->
    <form method="get" action="/assets" class="toolbar">
      <input type="text" name="q" value="{{ q }}" placeholder="Rechercher (serial, CFI, modèle, PO, client)">
      <div class="spacer"></div>
      <label>Par page
        <select name="per_page" onchange="this.form.submit()">
          {% for n in [10,20,50,100] %}
            <option value="{{ n }}" {% if per_page==n %}selected{% endif %}>{{ n }}</option>
          {% endfor %}
        </select>
      </label>
      <button class="btn btn--primary" type="submit">Chercher</button>
      <a class="btn" href="/">Accueil</a>
      <input type="hidden" name="page" value="1">
    </form>

    <!-- Table card with horizontal scroll for many columns -->
    <div class="card table-wrap">
      <table class="tbl">
        <thead>
          <tr>
            <th>ID</th>
            <th>Date ajout</th>
            <th>Serial</th>
            <th>CFI code</th>
            <th>Région</th>
            <th>CFI name</th>
            <th>Client #</th>
            <th>Client</th>
            <th>CPU</th>
            <th>Sockets</th>
            <th>Cœurs</th>
            <th>Modèle</th>
            <th>Adresse client</th>
            <th>Code postal</th>
            <th>Pays</th>
            <th>Order #</th>
            <th>PO</th>
            <th>BMC MAC</th>
            <th>Mémoire (MB)</th>
            <th>HBA</th>
            <th>BOSS</th>
            <th>PERC</th>
            <th>NVMe</th>
            <th>GPU</th>
            <th>Disques (JSON)</th>
            <th>MAC/NIC (JSON)</th>
          </tr>
        </thead>
        <tbody>
          {% macro yesno(v) -%}
            {# normalize booleans: treat 'YES','OUI','1', True as yes #}
            {% set s = (v|string).strip().lower() %}
            {% if v in [True, 1] or s in ['yes', 'oui', 'true', '1'] %}
              <span class="badge badge--yes">Oui</span>
            {% elif v in [False, 0] or s in ['no', 'non', 'false', '0'] %}
              <span class="badge badge--no">Non</span>
            {% else %}
              <span class="badge badge--neutral">{{ v if v is not none else '—' }}</span>
            {% endif %}
          {%- endmacro %}

          {% for a in assets %}
          <tr>
            <td>{{ a.id }}</td>
            <td>{{ a.date_add }}</td>
            <td>{{ a.serial }}</td>
            <td>{{ a.cfi_code }}</td>
            <td>{{ a.region }}</td>
            <td>{{ a.cfi_name }}</td>
            <td>{{ a.customer_number }}</td>
            <td>{{ a.customer_name }}</td>
            <td>{{ a.cpu }}</td>
            <td>{{ a.sockets }}</td>
            <td>{{ a.cores }}</td>
            <td>{{ a.model }}</td>
            <td>{{ a.customer_address }}</td>
            <td>{{ a.postcode }}</td>
            <td>{{ a.country }}</td>
            <td>{{ a.order_number }}</td>
            <td>{{ a.po_number }}</td>
            <td><code>{{ a.bmc_mac }}</code></td>
            <td>{{ a.memory }}</td>
            <td>{{ yesno(a.hba) }}</td>
            <td>{{ yesno(a.boss) }}</td>
            <td>{{ yesno(a.perc) }}</td>
            <td>{{ yesno(a.nvme) }}</td>
            <td>{{ yesno(a.gpu) }}</td>
            <td title="{{ a.hdd_json }}">{{ a.hdd_json }}</td>
            <td title="{{ a.mac_nic_json }}">{{ a.mac_nic_json }}</td>
          </tr>
          {% endfor %}
          {% if assets|length == 0 %}
            <tr><td colspan="26" class="muted">Aucun enregistrement.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      {% set last = (total // per_page) + (1 if (total % per_page) else 0) %}
      <span>Total: {{ total }}</span>
      {% if page > 1 %}
        <a href="/assets?page={{ page-1 }}&per_page={{ per_page }}&q={{ q|urlencode }}">Précédent</a>
      {% endif %}
      <span>Page {{ page }} / {{ last if last>0 else 1 }}</span>
      {% if page < last %}
        <a href="/assets?page={{ page+1 }}&per_page={{ per_page }}&q={{ q|urlencode }}">Suivant</a>
      {% endif %}
    </div>
  </div>
</body>
</html>
