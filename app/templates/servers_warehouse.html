<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Serveurs en stock (warehouse)</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .text-nowrap {
            white-space: nowrap;
        }
        table td, table th {
            vertical-align: middle;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">Serveurs en stock (warehouse)</h2>

    {% if message_ok %}
        <div class="alert alert-success">{{ message_ok }}</div>
    {% endif %}
    {% if message_error %}
        <div class="alert alert-danger">{{ message_error }}</div>
    {% endif %}

    <form method="post" action="/servers/warehouse" onsubmit="return collectSelection()">
        <input type="hidden" name="selected_ids" id="selected_ids" value="">

        <div class="table-responsive">
            <table class="table table-sm table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>PO Number</th>
                        <th>Vendor</th>
                        <th>Model</th>
                        <th>CFI Code</th>
                        <th>Serial</th>
                        <th>Country</th>
                        <th>NIC Interface Number</th>
                        <th>AP code authorized</th>
                        <th>Physical Zone</th>
                        <th>Power Watt</th>
                        <th>HeartBeat</th>
                        <th>Soki Name</th>
                        <th>SAN</th>
                        <th>✔</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in servers %}
                    <tr>
                        <td class="text-nowrap">{{ s.po_number }}</td>
                        <td class="text-nowrap">{{ s.vendor }}</td>
                        <td class="text-nowrap">{{ s.model }}</td>
                        <td class="text-nowrap">{{ s.cfi_code }}</td>
                        <td class="text-nowrap">{{ s.serial }}</td>
                        <td class="text-nowrap">{{ s.country }}</td>
                        <td><input type="text" class="form-control form-control-sm" value="{{ s.nic_count }}"></td>
                        <td>
                            <select class="form-select form-select-sm">
                                {% for ap in ap_codes %}
                                    <option value="{{ ap }}" {% if ap == s.ap_code %}selected{% endif %}>{{ ap }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                {% for zone in physical_zones %}
                                    <option value="{{ zone }}" {% if zone == s.physical_zone %}selected{% endif %}>{{ zone }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td><input type="number" class="form-control form-control-sm" value="{{ s.power_watt }}"></td>
                        <td><input type="text" class="form-control form-control-sm" value="{{ s.heartbeat }}"></td>
                        <td><input type="text" class="form-control form-control-sm" value="{{ s.soki_name }}"></td>
                        <td><input type="text" class="form-control form-control-sm" value="{{ s.san }}"></td>
                        <td><input type="checkbox" class="row-check" value="{{ s.id }}"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <button id="generateBtn" type="submit" class="btn btn-success mt-3" disabled>
            Générer le JSON des serveurs cochés
        </button>
        <a href="/" class="btn btn-secondary mt-3">Accueil</a>
    </form>
</div>

<script>
    function collectSelection() {
        let checkboxes = document.querySelectorAll(".row-check:checked");
        let ids = Array.from(checkboxes).map(cb => cb.value);

        if (ids.length === 0) {
            alert("Veuillez sélectionner au moins un serveur.");
            return false;
        }

        document.getElementById("selected_ids").value = ids.join(",");
        return true;
    }

    document.querySelectorAll(".row-check").forEach(cb => {
        cb.addEventListener("change", () => {
            let anyChecked = document.querySelectorAll(".row-check:checked").length > 0;
            document.getElementById("generateBtn").disabled = !anyChecked;
        });
    });
</script>
</body>
</html>
